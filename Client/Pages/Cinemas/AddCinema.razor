@page "/cinema/new" 
@inject HttpClient Http
@inject NavigationManager NavigationManager
@inject IJSRuntime jsRuntime
@using System.ComponentModel.DataAnnotations;

<CinemaForm Model="CinemaModel" ModelAccount="CinemaAccount" CallBack="HandleValidSubmit" ButtonText="Add new cinema"/>
<Alert Color="Color.Success" Visible="@(submitted && (int)_response.StatusCode == 200)" Style="margin-top: 10px;">
      <AlertMessage>Kino bolo pridané do databázy</AlertMessage>
    </Alert>
    <Alert Color="Color.Danger" Visible="@(submitted && (int)_response.StatusCode != 200)" Style="margin-top: 10px;">
      <AlertMessage>Kino sa nepodarilo vytvoriť</AlertMessage>
    </Alert>

@code {
    private HttpResponseMessage _response = new HttpResponseMessage();
    private bool submitted = false;
    public Cinema CinemaModel = new Cinema();
    public CinemaEmailAccount CinemaAccount = new CinemaEmailAccount();

    public async Task HandleValidSubmit(EditContext context)
    {
      CinemaModel.Account = CinemaAccount;
      _response = await Http.PostAsJsonAsync<Cinema>("/api/cinemas", CinemaModel);
      submitted = true;
      StateHasChanged();
    }
}
